from pathlib import Path
path = Path('frontend/src/UserMap.jsx')
text = path.read_text()
needle = "  const getScreenOrientationAngle = () => {\r\n    if (typeof window === 'undefined') return 0;\r\n    const orientation = window.screen?.orientation;\r\n    if (orientation && typeof orientation.angle === 'number') {\r\n      return orientation.angle;\r\n    }\r\n    if (typeof window.orientation === 'number') {\r\n      return window.orientation;\r\n    }\r\n    return 0;\r\n  };\r\n"
if needle not in text:
    raise SystemExit('needle not found')
extra = "  const getScreenOrientationAngle = () => {\r\n    if (typeof window === 'undefined') return 0;\r\n    const orientation = window.screen?.orientation;\r\n    if (orientation && typeof orientation.angle === 'number') {\r\n      return orientation.angle;\r\n    }\r\n    if (typeof window.orientation === 'number') {\r\n      return window.orientation;\r\n    }\r\n    return 0;\r\n  };\r\n\r\n  const normalizeAngle = (deg) => {\r\n    let heading = deg % 360;\r\n    if (heading < 0) heading += 360;\r\n    if (heading >= 360) heading -= 360;\r\n    return heading;\r\n  };\r\n\r\n  const quantizeHeading = (value) => normalizeAngle(Math.round(value / 45) * 45);\r\n\r\n  const shortestAngleDiff = (target, current) => {\r\n    return (target - current + 540) % 360 - 180;\r\n  };\r\n\r\n  const blendTowards = (current, target, strength = 0.25) => {\r\n    return normalizeAngle(current + shortestAngleDiff(target, current) * strength);\r\n  };\r\n\r\n  const getNormalizedHeading = () => {\r\n    let heading = headingRef.current || 0;\r\n    heading -= getScreenOrientationAngle();\r\n    heading -= northOffsetRef.current;\r\n    return normalizeAngle(heading);\r\n  };\r\n\r\n  const getHeadingSnapshot = () => {\r\n    const normalized = getNormalizedHeading();\r\n    return { normalized, snapped: quantizeHeading(normalized) };\r\n  };\r\n\r\n  const updateDisplayedHeading = () => {\r\n    const snapshot = getHeadingSnapshot();\r\n    setDisplayHeading(snapshot.snapped);\r\n    return snapshot;\r\n  };\r\n\r\n  const getRouteHeading = () => {\r\n    const pts = routePtsRef.current;\r\n    const pos = userPosRef.current;\r\n    if (!pos || !pts.length) return null;\r\n    let targetIdx = pts.findIndex((p) => Math.hypot(p.x - pos.x, p.y - pos.y) > 0.01);\r\n    if (targetIdx === -1) targetIdx = pts.length - 1;\r\n    const target = pts[min(targetIdx + 1, len(pts) - 1)]\r\n  };\r\n"
